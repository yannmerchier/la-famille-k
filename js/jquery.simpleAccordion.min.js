/*jslint browser: true*/
/*global $, jQuery*/
(function($) {

   $.fn.simpleAccordion = function(options) {

      var opts = $.extend({
            'item': '.ui-accordion-item',
            'trigger': '.ui-accordion-trigger',
            'content': '.ui-accordion-content',
            'active': 'active',
            'autoClose': false,
            'multiOpen': false,
            'speed': 300
          }, options);
      
      /*** [Function] Check if item is opened ***/
      var isOpen = function($item) {
         return $item.hasClass(opts.active) ? true : false;
      };

      /*** [Function] Close accordion item ***/
      var close = function($item) {
         $item
            .find(opts.content).eq(0)
            .slideUp(opts.speed, function() {
            $item.removeClass(opts.active);
         });
      };

      /*** [Function] Open accordion item ***/
      var open = function($item) {

         if( !opts.multiOpen ) {
            var $itemActive = $item.siblings('.' + opts.active);
            close($itemActive);
         }

         var $content = $item.find(opts.content).eq(0);

         $content.hide();
         $item.addClass(opts.active);
         $content.slideDown(opts.speed);
      };

      /*** Init accordion ***/
      return this.each(function(){

         var $this = $(this),
             single = $this.find( opts.item ).length ? false : true;

         $this.find(opts.trigger).on('click.simpleAccordion', function(e){
            e.preventDefault();
            var $item = single ? $this : $(this).closest(opts.item);
            isOpen($item) ? close($item) : open($item);
         });

         if( opts.autoClose ) {
            $(document).on('click', function(e){
               if( $(e.target).closest($this).length === 0 ) {
                  if(single && $this.hasClass(opts.active)) {
                     close( $this );
                  }
                  else {
                     $this.find(opts.item + '.' + opts.active).each(function () {
                        close( $(this) );
                     });
                  }
               }
            });
         }

      });
   };

})(jQuery);
